# OCF Security Transfer Types

**Date**: 2026-01-20 **Status**: Complete **Priority**: Medium **Parent**:
[Milestone 2: OCP SDK Implementation](../../../2025/12/2025.12.17-milestone-2-ocp-sdk-implementation.md)

## Overview

Implement SDK support for transferring securities between stakeholders. StockTransfer is already
implemented; this task covers the remaining transfer types.

## Types to Implement (3 types)

| Type                       | Description                            | DAML Support |
| -------------------------- | -------------------------------------- | ------------ |
| ConvertibleTransfer        | Transfer convertible notes             | ✅           |
| EquityCompensationTransfer | Transfer equity compensation (options) | ✅           |
| WarrantTransfer            | Transfer warrants                      | ✅           |

## Already Implemented

- **StockTransfer** ✅ - Reference implementation in existing codebase

## Implementation Checklist

### ConvertibleTransfer

- [x] Add `toConvertibleTransfer` converter in `ocfToDaml.ts` (already exists)
- [x] Add `fromConvertibleTransfer` converter for DAML → OCF (`getConvertibleTransferAsOcf.ts`)
- [x] Add unit tests for converters (`test/converters/transferConverters.test.ts`)
- [x] Add integration test via batch API (`test/integration/entities/transferTypes.integration.test.ts`)

### EquityCompensationTransfer

- [x] Add `toEquityCompensationTransfer` converter in `ocfToDaml.ts` (already exists)
- [x] Add `fromEquityCompensationTransfer` converter for DAML → OCF
      (`getEquityCompensationTransferAsOcf.ts`)
- [x] Add unit tests for converters (`test/converters/transferConverters.test.ts`)
- [x] Add integration test via batch API (`test/integration/entities/transferTypes.integration.test.ts`)

### WarrantTransfer

- [x] Add `toWarrantTransfer` converter in `ocfToDaml.ts` (already exists)
- [x] Add `fromWarrantTransfer` converter for DAML → OCF (`getWarrantTransferAsOcf.ts`)
- [x] Add unit tests for converters (`test/converters/transferConverters.test.ts`)
- [x] Add integration test via batch API (`test/integration/entities/transferTypes.integration.test.ts`)

## Implementation Notes

All transfer types share a common pattern:

1. **Source security** is referenced by `security_id`
2. **Resulting security IDs** are created for the recipient
3. **Balance security ID** may be created if partial transfer
4. **Quantity** specifies amount being transferred

Reference the existing `StockTransfer` implementation for the pattern.

## Validation

```bash
npm run fix                    # Lint/format
npm run typecheck              # Type check
npm test                       # Unit tests
npm run test:integration       # Integration tests
```

## Dependencies

- Batch API must be complete ([Batch Cap Table Updates](./2026.01.12-batch-cap-table-updates.md))
- Base issuance types for each security must exist (ConvertibleIssuance, EquityCompensationIssuance,
  WarrantIssuance - all ✅)

## Related

- [ADR-001: Batch Cap Table Updates](../../../../adr/001-batch-cap-table-updates.md)
- [Milestone 2: OCP SDK Implementation](../../../2025/12/2025.12.17-milestone-2-ocp-sdk-implementation.md)
- Existing StockTransfer implementation for reference

## Changelog

| Date       | Change                                                                   | PRs  |
| ---------- | ------------------------------------------------------------------------ | ---- |
| 2026-01-20 | Created task                                                             | —    |
| 2026-01-21 | Implemented DAML→OCF converters for all 3 transfer types + test fixtures | —    |
| 2026-01-21 | Added integration tests, unit tests, and test data factories per review  | #183 |

---

_Last updated: 2026-01-21_

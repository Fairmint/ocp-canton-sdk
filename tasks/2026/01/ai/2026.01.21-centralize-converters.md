# Centralize Converters

**Date**: 2026-01-21  
**Status**: Open  
**Priority**: High  
**Source**: [OCP Protocol Review](./2026.01.21-ocp-protocol-review.md) — Issue 2.1

## Problem

DAML↔OCF conversion functions are scattered across multiple locations:

- `src/functions/OpenCapTable/*/create*.ts` — `*DataToDaml` functions
- `src/functions/OpenCapTable/*/get*AsOcf.ts` — `daml*ToNative` functions
- `src/functions/OpenCapTable/capTable/ocfToDaml.ts` — dispatcher
- `src/utils/typeConversions.ts` — shared helpers

The same enum conversion logic appears in multiple files.

## Evidence

```typescript
// In createIssuer.ts
function emailTypeToDaml(emailType: EmailType): Fairmint.OpenCapTable.Types.OcfEmailType {
  switch (emailType) { ... }
}

// In getIssuerAsOcf.ts
function damlEmailTypeToNative(damlType: Fairmint.OpenCapTable.Types.OcfEmailType): EmailType {
  switch (damlType) { ... }
}
```

## Recommendation

Create a `src/converters/` directory with:

- `src/converters/enums.ts` — all enum conversions (bidirectional)
- `src/converters/types.ts` — shared type conversions
- `src/converters/entities/<entity>.ts` — entity-specific conversions
- `src/converters/index.ts` — unified `toDaml()` and `toOcf()` dispatchers

## Tasks

- [ ] Create `src/converters/` directory structure
- [ ] Extract and deduplicate enum conversions
- [ ] Extract shared type conversions
- [ ] Create bidirectional entity converters
- [ ] Update `ocfToDaml.ts` to use centralized converters
- [ ] Update all `get*AsOcf` functions to use centralized converters
- [ ] Remove duplicate code from original locations
- [ ] Add tests for all converters

## Acceptance Criteria

- All conversion logic lives in `src/converters/`
- Each enum has a single bidirectional converter
- No duplicate conversion code remains
- 100% test coverage on converters

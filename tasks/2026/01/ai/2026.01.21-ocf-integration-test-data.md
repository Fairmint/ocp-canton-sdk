# OCF Integration Test Data from Production Database

**Date**: 2026-01-21 **Status**: Open **Priority**: High **Parent**:
[Milestone 2: OCP SDK Implementation](../../../2025/12/2025.12.17-milestone-2-ocp-sdk-implementation.md)

## Overview

Source anonymized real-world data from the production database to use in integration tests. Real
data raises confidence compared to synthetic fixtures because it captures edge cases, unusual field
combinations, and real-world data patterns that generated examples may miss.

## Goal

For each OCF type:

1. Connect to prod database and extract representative objects
2. Anonymize all PII and sensitive business data
3. Publish anonymized objects to DAML contracts
4. Read back from contracts
5. Assert the recreated object matches the original (round-trip validation)

## Test Workflow

```
Prod DB → Anonymize → OCF Object → Publish to DAML → Read from DAML → Compare with Original
```

This validates:

- Type conversions are correct (OCF ↔ DAML)
- No data loss during round-trip
- Edge cases from real data are handled
- Field mappings are complete

## Implementation Requirements

### Database Connection

- [ ] Create secure prod database connection utility
- [ ] Implement query functions for each OCF object type
- [ ] Add anonymization layer (PII scrubbing, ID replacement)
- [ ] Create fixture export for offline testing

### Anonymization Rules

- Replace names with generic placeholders (e.g., "Stakeholder 1")
- Replace email addresses with `test-{n}@example.com`
- Replace company names with "Test Company {n}"
- Preserve data types, formats, and relationships
- Keep numeric values realistic but scrambled
- Preserve dates (relative to each other) but shift by random offset

### Test Infrastructure

- [ ] Add prod data fixtures to `test/fixtures/prod-anonymized/`
- [ ] Create round-trip test helpers
- [ ] Add validation comparing original vs recreated objects

---

## OCF Type Checklist

Status format: `{count} anonymized` or `{count} generated` with brief scenario notes.

### Objects (Core Entities)

| Type                | SDK | Status | Scenarios |
| ------------------- | --- | ------ | --------- |
| Issuer              | ✅  | —      |           |
| Stakeholder         | ✅  | —      |           |
| StockClass          | ✅  | —      |           |
| StockPlan           | ✅  | —      |           |
| VestingTerms        | ✅  | —      |           |
| Document            | ✅  | —      |           |
| StockLegendTemplate | ✅  | —      |           |
| Valuation           | ✅  | —      |           |

### Security Issuances

| Type                       | SDK | Status | Scenarios |
| -------------------------- | --- | ------ | --------- |
| StockIssuance              | ✅  | —      |           |
| ConvertibleIssuance        | ✅  | —      |           |
| EquityCompensationIssuance | ✅  | —      |           |
| WarrantIssuance            | ✅  | —      |           |

### Security Cancellations

| Type                           | SDK | Status | Scenarios |
| ------------------------------ | --- | ------ | --------- |
| StockCancellation              | ✅  | —      |           |
| ConvertibleCancellation        | ✅  | —      |           |
| EquityCompensationCancellation | ✅  | —      |           |
| WarrantCancellation            | ✅  | —      |           |

### Security Transfers

| Type                       | SDK | Status | Scenarios |
| -------------------------- | --- | ------ | --------- |
| StockTransfer              | ✅  | —      |           |
| ConvertibleTransfer        | ✅  | —      |           |
| EquityCompensationTransfer | ✅  | —      |           |
| WarrantTransfer            | ✅  | —      |           |

### Security Acceptances

| Type                         | SDK | Status | Scenarios |
| ---------------------------- | --- | ------ | --------- |
| StockAcceptance              | ✅  | —      |           |
| ConvertibleAcceptance        | ✅  | —      |           |
| EquityCompensationAcceptance | ✅  | —      |           |
| WarrantAcceptance            | ✅  | —      |           |

### Exercise & Conversion

| Type                       | SDK | Status | Scenarios |
| -------------------------- | --- | ------ | --------- |
| EquityCompensationExercise | ✅  | —      |           |
| WarrantExercise            | ✅  | —      |           |
| ConvertibleConversion      | ✅  | —      |           |
| StockConversion            | ✅  | —      |           |

### Vesting Events

| Type                | SDK | Status | Scenarios |
| ------------------- | --- | ------ | --------- |
| VestingStart        | ✅  | —      |           |
| VestingEvent        | ✅  | —      |           |
| VestingAcceleration | ✅  | —      |           |

### Stock & Issuer Adjustments

| Type                                 | SDK | Status | Scenarios |
| ------------------------------------ | --- | ------ | --------- |
| IssuerAuthorizedSharesAdjustment     | ✅  | —      |           |
| StockClassAuthorizedSharesAdjustment | ✅  | —      |           |
| StockPlanPoolAdjustment              | ✅  | —      |           |
| StockClassSplit                      | ✅  | —      |           |
| StockClassConversionRatioAdjustment  | ✅  | —      |           |
| StockConsolidation                   | ✅  | —      |           |

### Other Transactions

| Type            | SDK | Status | Scenarios |
| --------------- | --- | ------ | --------- |
| StockRepurchase | ✅  | —      |           |
| StockReissuance | ✅  | —      |           |

### Security Retractions

| Type                         | SDK | Status | Scenarios |
| ---------------------------- | --- | ------ | --------- |
| StockRetraction              | ✅  | —      |           |
| ConvertibleRetraction        | ✅  | —      |           |
| EquityCompensationRetraction | ✅  | —      |           |
| WarrantRetraction            | ✅  | —      |           |

### Equity Compensation Events

| Type                        | SDK | Status | Scenarios |
| --------------------------- | --- | ------ | --------- |
| EquityCompensationRelease   | ✅  | —      |           |
| EquityCompensationRepricing | ✅  | —      |           |

### Stock Plan Events

| Type                  | SDK | Status | Scenarios |
| --------------------- | --- | ------ | --------- |
| StockPlanReturnToPool | ✅  | —      |           |

### Stakeholder Events

| Type                               | SDK | Status | Scenarios |
| ---------------------------------- | --- | ------ | --------- |
| StakeholderRelationshipChangeEvent | ✅  | —      |           |
| StakeholderStatusChangeEvent       | ✅  | —      |           |

---

## Status Legend

- **SDK**: ✅ = Implemented, ❌ = Not yet implemented
- **Status**: Brief count and source, e.g.:
  - `3 anonymized` — 3 anonymized objects from prod
  - `2 generated` — 2 synthetic examples (no real-world data available)
  - `—` — Not started
- **Scenarios**: Brief notes on what's covered, e.g.:
  - "founder grant, employee grant, advisor grant"
  - "full exercise, partial exercise"
  - "2-for-1 split, 10-for-1 split"

---

## Priority Order

### Phase 1: Core Entities (High Priority)

Start with entities that appear in every cap table:

1. Issuer
2. Stakeholder
3. StockClass
4. StockIssuance
5. StockPlan
6. EquityCompensationIssuance

### Phase 2: Common Transactions

Transactions that occur frequently:

1. StockCancellation
2. StockTransfer
3. EquityCompensationExercise
4. Valuation
5. VestingTerms
6. VestingStart/VestingEvent

### Phase 3: Less Common Types

7. ConvertibleIssuance/Cancellation/Conversion
8. WarrantIssuance/Cancellation/Exercise
9. Stock class adjustments (splits, etc.)

### Phase 4: Rare Types

10. Retractions, reissuances
11. Stakeholder events
12. Repricing

---

## Validation

```bash
npm run fix                    # Lint/format
npm run typecheck              # Type check
npm test                       # Unit tests
npm run test:integration       # Integration tests with prod fixtures
```

## Security Considerations

- Never commit unredacted prod data
- Review anonymized fixtures before committing
- Use environment variables for database credentials
- Prod connection only available in secure environments

## Dependencies

- Production database access (read-only)
- Anonymization utilities
- SDK support for each type ✅ (all 48 types now implemented)

## Related

- [Comprehensive Integration Tests](../../../2025/12/2025.12.30-comprehensive-integration-tests.md)
- [Milestone 2: OCP SDK Implementation](../../../2025/12/2025.12.17-milestone-2-ocp-sdk-implementation.md)
- [Remaining OCF Types](./2026.01.13-remaining-ocf-types.md)

## Changelog

| Date       | Change       | PRs |
| ---------- | ------------ | --- |
| 2026-01-21 | Created task | —   |

---

_Last updated: 2026-01-21_

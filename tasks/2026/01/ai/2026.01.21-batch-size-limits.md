# Batch Size Limits

**Date**: 2026-01-21  
**Status**: Closed (Won't Do)  
**Closed**: 2026-01-22  
**Priority**: Low  
**Source**: [OCP Protocol Review](./2026.01.21-ocp-protocol-review.md) — Issue 7.1

## Problem

The batch API doesn't enforce or document maximum batch sizes. Large batches may timeout or fail
with unclear errors.

## Resolution

**Closed as Won't Do** — Batch size limits are best handled at the application/client script level,
not in the SDK.

### Rationale

1. **Flexibility**: Different applications have different requirements. Some may need small batches
   for real-time UX, others may benefit from larger batches for data migrations.

2. **Caller responsibility**: The SDK provides a flexible `CapTableBatch` class with a `size`
   property. Callers can easily implement their own batching logic:

   ```typescript
   const BATCH_SIZE = 100;
   for (let i = 0; i < items.length; i += BATCH_SIZE) {
     const batch = ocp.OpenCapTable.capTable.batch(params);
     items.slice(i, i + BATCH_SIZE).forEach((item) => batch.create('stakeholder', item));
     await batch.execute();
   }
   ```

3. **Canton limits vary**: Transaction limits depend on Canton network configuration and can change.
   Hardcoding limits in the SDK would require version bumps to adjust.

4. **Error handling is clearer at app level**: When batches fail, applications can implement retry
   logic with smaller batches, backoff strategies, etc. based on their specific needs.

## Original Recommendation (Not Implemented)

Add configurable limits and pagination:

```typescript
const MAX_BATCH_SIZE = 100;

create<T extends OcfEntityType>(type: T, data: OcfDataTypeFor<T>): this {
  if (this.size >= MAX_BATCH_SIZE) {
    throw new OcpValidationError('batch', `Maximum batch size (${MAX_BATCH_SIZE}) exceeded`);
  }
  // ...
}
```

## Tasks

- [x] ~~Research Canton/DAML transaction size limits~~ — Varies by deployment
- [x] ~~Determine safe default batch size~~ — Client responsibility
- [x] ~~Add configurable `maxBatchSize` option~~ — Not needed
- [x] ~~Add clear error when batch size exceeded~~ — Canton provides errors
- [x] ~~Document batch size limits~~ — Client responsibility
- [x] ~~Consider pagination helper for large datasets~~ — Client responsibility

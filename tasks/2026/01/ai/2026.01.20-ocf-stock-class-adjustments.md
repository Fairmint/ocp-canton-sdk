# OCF Stock Class Adjustment Types

**Date**: 2026-01-20 **Status**: Complete **Priority**: Medium **Parent**:
[Milestone 2: OCP SDK Implementation](../../../2025/12/2025.12.17-milestone-2-ocp-sdk-implementation.md)

## Overview

Implement SDK support for stock class adjustments and corporate actions. These types affect entire
stock classes rather than individual securities.

## Types to Implement (4 types)

| Type                                | Description                       | DAML Support | SDK Support |
| ----------------------------------- | --------------------------------- | ------------ | ----------- |
| StockClassSplit                     | Stock split (e.g., 2-for-1)       | ✅           | ✅          |
| StockClassConversionRatioAdjustment | Adjust conversion ratio           | ✅           | ✅          |
| StockConsolidation                  | Reverse stock split               | ✅           | ✅          |
| StockReissuance                     | Reissue cancelled/forfeited stock | ✅           | ✅          |

## Already Implemented

- **StockClassAuthorizedSharesAdjustment** ✅ - Reference implementation

## Implementation Checklist

### StockClassSplit

- [x] Add `toStockClassSplit` converter in `ocfToDaml.ts` (already existed)
- [x] Add `fromStockClassSplit` converter for DAML → OCF (`getStockClassSplitEventAsOcf.ts`)
- [x] Add unit tests for converters (`stockClassAdjustments.test.ts`)
- [x] Add integration test via batch API (`stockClassAdjustments.integration.test.ts`)

### StockClassConversionRatioAdjustment

- [x] Add `toStockClassConversionRatioAdjustment` converter in `ocfToDaml.ts` (already existed)
- [x] Add `fromStockClassConversionRatioAdjustment` converter for DAML → OCF
      (`getStockClassConversionRatioAdjustmentEventAsOcf.ts`)
- [x] Add unit tests for converters (`stockClassAdjustments.test.ts`)
- [x] Add integration test via batch API (`stockClassAdjustments.integration.test.ts`)

### StockConsolidation

- [x] Add `toStockConsolidation` converter in `ocfToDaml.ts` (already existed)
- [x] Add `fromStockConsolidation` converter for DAML → OCF (`getStockConsolidationEventAsOcf.ts`)
- [x] Add unit tests for converters (`stockClassAdjustments.test.ts`)
- [x] Add integration test via batch API (`stockClassAdjustments.integration.test.ts`)

### StockReissuance

- [x] Add `toStockReissuance` converter in `ocfToDaml.ts` (already existed)
- [x] Add `fromStockReissuance` converter for DAML → OCF (`getStockReissuanceEventAsOcf.ts`)
- [x] Add unit tests for converters (`stockClassAdjustments.test.ts`)
- [x] Add integration test via batch API (`stockClassAdjustments.integration.test.ts`)

## Implementation Notes

### StockClassSplit / StockConsolidation

These types include:

- `split_ratio` - The ratio of the split (e.g., "2:1" for 2-for-1)
- `stock_class_id` - The stock class being split
- All existing securities of that class are affected

### StockClassConversionRatioAdjustment

Used when conversion terms change:

- `new_ratio_conversion_mechanism` - Updated conversion terms
- Affects how convertibles/warrants convert to this stock class

### StockReissuance

Used to reissue previously cancelled or forfeited shares:

- `resulting_security_ids` - New securities created
- Links to original cancelled security

## Validation

```bash
npm run fix                    # Lint/format
npm run typecheck              # Type check
npm test                       # Unit tests
npm run test:integration       # Integration tests
```

## Dependencies

- Batch API must be complete ([Batch Cap Table Updates](./2026.01.12-batch-cap-table-updates.md))
- StockClass type must be implemented ✅

## Related

- [ADR-001: Batch Cap Table Updates](../../../../adr/001-batch-cap-table-updates.md)
- [Milestone 2: OCP SDK Implementation](../../../2025/12/2025.12.17-milestone-2-ocp-sdk-implementation.md)
- Existing StockClassAuthorizedSharesAdjustment for reference

## Changelog

| Date       | Change                                                                     | PRs |
| ---------- | -------------------------------------------------------------------------- | --- |
| 2026-01-20 | Created task                                                               | —   |
| 2026-01-21 | Implemented all 4 types with DAML→OCF converters, unit & integration tests | TBD |

---

_Last updated: 2026-01-21_

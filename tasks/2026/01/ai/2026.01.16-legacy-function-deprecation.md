# Legacy Function Deprecation

**Date**: 2026-01-16 **Status**: Complete **Priority**: Low **Depends On**:
[Batch Cap Table Updates](./2026.01.12-batch-cap-table-updates.md)

## Overview

Deprecate and eventually remove legacy per-entity create/edit/delete functions that have been
superseded by the batch `UpdateCapTable` API.

## Current State

The SDK has two patterns for modifying cap table entities:

### Legacy Pattern (Individual Functions)

Each entity has separate create/edit functions:

```typescript
// Legacy: Individual create functions
const cmd = ocp.OpenCapTable.stakeholder.buildCreateStakeholderCommand({
  issuerContractId,
  featuredAppRightContractDetails,
  stakeholderData,
});
await batch.addCommand(cmd.command, cmd.disclosedContracts);
await batch.submitAndWait();
```

### New Pattern (Batch API)

The `UpdateCapTable` choice handles all modifications atomically:

```typescript
// New: Batch API
const result = await ocp.OpenCapTable.capTable
  .update({ capTableContractId, featuredAppRightContractDetails, actAs })
  .create('stakeholder', stakeholderData)
  .execute();
```

### Files Affected

The following legacy function files exist in `src/functions/OpenCapTable/`:

| Entity                                  | create                                     | delete | get\*AsOcf                                        |
| --------------------------------------- | ------------------------------------------ | ------ | ------------------------------------------------- |
| `stakeholder/`                          | stakeholderDataToDaml                      | -      | getStakeholderAsOcf                               |
| `stockClass/`                           | stockClassDataToDaml                       | -      | getStockClassAsOcf                                |
| `stockIssuance/`                        | createStockIssuance                        | -      | getStockIssuanceAsOcf                             |
| `stockPlan/`                            | createStockPlan                            | -      | getStockPlanAsOcf                                 |
| `stockLegendTemplate/`                  | createStockLegendTemplate                  | -      | getStockLegendTemplateAsOcf                       |
| `vestingTerms/`                         | createVestingTerms                         | -      | getVestingTermsAsOcf                              |
| `document/`                             | createDocument                             | -      | getDocumentAsOcf                                  |
| `convertibleIssuance/`                  | createConvertibleIssuance                  | -      | getConvertibleIssuanceAsOcf                       |
| `warrantIssuance/`                      | createWarrantIssuance                      | -      | getWarrantIssuanceAsOcf                           |
| `equityCompensationIssuance/`           | createEquityCompensationIssuance           | -      | getEquityCompensationIssuanceEventAsOcf           |
| `stockCancellation/`                    | createStockCancellation                    | -      | getStockCancellationEventAsOcf                    |
| `warrantCancellation/`                  | createWarrantCancellation                  | -      | getWarrantCancellationEventAsOcf                  |
| `convertibleCancellation/`              | createConvertibleCancellation              | -      | getConvertibleCancellationEventAsOcf              |
| `equityCompensationCancellation/`       | createEquityCompensationCancellation       | -      | getEquityCompensationCancellationEventAsOcf       |
| `stockTransfer/`                        | createStockTransfer                        | -      | getStockTransferAsOcf                             |
| `issuerAuthorizedSharesAdjustment/`     | createIssuerAuthorizedSharesAdjustment     | -      | getIssuerAuthorizedSharesAdjustmentEventAsOcf     |
| `stockClassAuthorizedSharesAdjustment/` | createStockClassAuthorizedSharesAdjustment | -      | getStockClassAuthorizedSharesAdjustmentEventAsOcf |
| `stockPlanPoolAdjustment/`              | createStockPlanPoolAdjustment              | -      | getStockPlanPoolAdjustmentEventAsOcf              |
| `equityCompensationExercise/`           | createEquityCompensationExercise           | -      | getEquityCompensationExerciseEventAsOcf           |
| `stockRepurchase/`                      | stockRepurchaseDataToDaml                  | -      | getStockRepurchaseAsOcf                           |

**Note:** The `get*AsOcf` functions are **not deprecated** - they remain useful for reading
individual entities from the ledger.

## Goals

### 1. Mark Legacy Functions as Deprecated

Add JSDoc `@deprecated` annotations to legacy create functions:

```typescript
/**
 * @deprecated Use `ocp.OpenCapTable.capTable.update().create('stakeholder', data).execute()`
 *   instead. This function will be removed in a future major version.
 */
export function buildCreateStakeholderCommand(
  params: CreateStakeholderParams
): CommandWithDisclosedContracts {
  // ... existing implementation
}
```

### 2. Update Documentation

- Add migration guide showing old vs new patterns
- Update examples to use batch API
- Add deprecation notices to TypeDoc output

### 3. Move to Legacy Folder (Optional)

If desired, move deprecated files to `src/functions/OpenCapTable/legacy/`:

```
src/functions/OpenCapTable/
├── capTable/                    # New batch API (keep)
├── legacy/                      # Deprecated functions
│   ├── createStakeholder.ts
│   ├── createStockClass.ts
│   └── ...
└── stakeholder/
    └── getStakeholderAsOcf.ts   # Keep (not deprecated)
```

### 4. Removal Timeline

- **v0.3.x**: Mark as deprecated, continue to support
- **v1.0.0**: Remove legacy create/edit/delete functions

## Implementation Plan

### Phase 1: Add Deprecation Notices

- [x] Add `@deprecated` JSDoc to all legacy `*DataToDaml` functions (20 functions)
- [ ] ~~Add `@deprecated` JSDoc to all legacy `buildEdit*Command` functions~~ (none exist)
- [ ] ~~Add `@deprecated` JSDoc to all legacy `buildDelete*Command` functions~~ (none exist)
- [x] TypeDoc will automatically show deprecation warnings from JSDoc tags

### Phase 2: Documentation

- [ ] Create migration guide: `docs/migration-to-batch-api.md`
- [ ] Update README with batch API examples
- [ ] Update `llms.txt` with deprecation notes

### Phase 3: Update Internal Usage

- [ ] Update integration tests to use batch API where applicable
- [ ] Ensure all examples in docs use batch API

### Phase 4: Cleanup (Future - v1.0.0)

- [ ] Remove deprecated functions
- [ ] Remove unused `*DataToDaml` functions (keep converters used by batch API)
- [ ] Update exports in index files

## Files to Modify

All `create*.ts`, `edit*.ts`, `delete*.ts` files in:

- `src/functions/OpenCapTable/*/`

## Validation

```bash
npm run fix                    # Lint/format
npm run typecheck              # Type check
npm test                       # Unit tests
npm run test:integration       # Integration tests
npm run docs                   # Verify TypeDoc shows deprecations
```

## Related

- [Batch Cap Table Updates](./2026.01.12-batch-cap-table-updates.md) - New API that replaces legacy
  functions
- [ADR-001: Batch Cap Table Updates](../../../../adr/001-batch-cap-table-updates.md) - Design
  rationale

## Changelog

| Date       | Change                                                    | PRs |
| ---------- | --------------------------------------------------------- | --- |
| 2026-01-16 | Created task                                              | --  |
| 2026-01-20 | Added @deprecated JSDoc to all 20 *DataToDaml functions   | --  |

---

_Last updated: 2026-01-20_

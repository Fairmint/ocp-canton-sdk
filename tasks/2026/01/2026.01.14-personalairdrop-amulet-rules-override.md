# Task: Support PersonalAirdrop AmuletRules Override

## Status: Blocked

**Blocked by**: Waiting for `@fairmint/open-captable-protocol-daml-js` NPM package to publish with CantonPayments v0.0.31

**Created**: 2026-01-14
**Priority**: Medium

## Summary

Update the ocp-canton-sdk to support the new `amuletRulesCidOverride` parameter added to `PersonalAirdrop_ExecuteTransfer` choice in CantonPayments v0.0.31.

## Background

The DAML `PersonalAirdrop_ExecuteTransfer` choice now accepts an optional `amuletRulesCidOverride` parameter:
- When `None`/`null`: Uses stored `amuletRulesCid` (existing behavior)
- When `Some`/provided: Uses the provided AmuletRules contract ID

This change was made in `open-captable-protocol-daml` to enable updating AmuletRules references without recreating contracts.

## Implementation Steps

### Phase 1: Backwards Compatible Update

1. Update `@fairmint/open-captable-protocol-daml-js` dependency to latest version with CantonPayments v0.0.31

2. Find all SDK functions that exercise `PersonalAirdrop_ExecuteTransfer`:
   ```bash
   grep -r "PersonalAirdrop_ExecuteTransfer" src/
   ```

3. Update each exercise call to pass `null` for `amuletRulesCidOverride`:
   ```typescript
   // Before
   await ledger.exercise(PersonalAirdrop_ExecuteTransfer, {
     amuletInputs,
     openMiningRoundCid,
     amount,
     numberOfTransfers,
     optMergeAmuletInputs,
   });
   
   // After
   await ledger.exercise(PersonalAirdrop_ExecuteTransfer, {
     amuletInputs,
     openMiningRoundCid,
     amount,
     numberOfTransfers,
     optMergeAmuletInputs,
     amuletRulesCidOverride: null,  // NEW: pass null for default behavior
   });
   ```

### Phase 2: Add Override Support (Optional, Future)

1. Add optional `amuletRulesCidOverride` parameter to relevant SDK function signatures

2. Update type definitions if needed

3. Document the new parameter in JSDoc comments

## Testing Requirements

- [ ] Update unit tests for any modified SDK functions
- [ ] Run integration tests to verify backwards compatibility: `npm run test:integration`
- [ ] Verify `npm run fix` passes (linting/formatting)
- [ ] Verify `npm run typecheck` passes (TypeScript)

## Acceptance Criteria

- [ ] SDK compiles with new DAML package version
- [ ] All existing tests pass
- [ ] Exercise calls include `amuletRulesCidOverride: null`
- [ ] No runtime behavior changes (backwards compatible)

## Related

- DAML PR: CantonPayments v0.0.31 - PersonalAirdrop AmuletRules Override
- Release Notes: `docs/releases/2026.01.14-cantonpayments-amulet-rules-override.md`

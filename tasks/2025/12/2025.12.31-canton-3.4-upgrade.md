# Task: Canton 3.4 Upgrade

**Date**: 2025-12-31  
**Status**: In Progress  
**Target Repo**: `ocp-canton-sdk`  
**Parent Task**:
[canton/tasks/2025/12/2025.12.31-canton-3.4-upgrade.md](https://github.com/Fairmint/canton/blob/main/tasks/2025/12/2025.12.31-canton-3.4-upgrade.md)

## Goal

Update the OCP Canton SDK to be compatible with Canton 3.4 by upgrading dependencies and making any
necessary code changes.

---

## Background

Canton 3.4 brings changes to the DAML/Canton infrastructure. This SDK depends on:

| Package                                    | Current Version | Target Version | Notes                   |
| ------------------------------------------ | --------------- | -------------- | ----------------------- |
| `@fairmint/open-captable-protocol-daml-js` | 0.2.68          | 0.2.86+        | Generated DAML bindings |
| `@fairmint/canton-node-sdk`                | 0.0.148         | Latest         | Low-level Canton client |
| `@daml/ledger`                             | 2.10.3          | TBD            | DAML Ledger API client  |
| `@daml/types`                              | 3.4.10          | TBD            | DAML type definitions   |

---

## Scope

### In Scope

1. **Dependency Updates**
   - [ ] Upgrade `@fairmint/open-captable-protocol-daml-js` to latest compatible version
   - [ ] Upgrade `@fairmint/canton-node-sdk` if needed for Canton 3.4 compatibility
   - [ ] Update `@daml/ledger` and `@daml/types` if Canton 3.4 requires newer versions

2. **Code Changes**
   - [ ] Update any type imports that changed in new DAML bindings
   - [ ] Fix any breaking API changes in canton-node-sdk
   - [ ] Update type conversions if DAML schema changed
   - [ ] Fix any deprecated API usage

3. **Testing**
   - [ ] Verify all unit tests pass
   - [ ] Verify all integration tests pass against Canton 3.4 LocalNet
   - [ ] Test type checking passes (`npm run typecheck`)

### Out of Scope

- New feature development
- DAML contract changes (handled in separate repos)
- Performance optimization

---

## Implementation Plan

### Phase 1: Dependency Analysis

1. Review release notes for:
   - `@fairmint/open-captable-protocol-daml-js` changes from 0.2.68 to latest
   - `@fairmint/canton-node-sdk` changes
   - Canton 3.4 breaking changes affecting TypeScript SDKs

2. Document any breaking changes that affect this SDK

### Phase 2: Dependency Upgrades

```bash
# Update Fairmint packages to latest
npm install --save-exact @fairmint/open-captable-protocol-daml-js@latest
npm install --save-exact @fairmint/canton-node-sdk@latest

# Update DAML packages if needed (verify compatibility first)
# npm install --save-exact @daml/ledger@<version>
# npm install --save-exact @daml/types@<version>
```

### Phase 3: Code Updates

1. Run type check to identify breaking changes:

   ```bash
   npm run typecheck
   ```

2. Fix any type errors:
   - Updated template IDs
   - Changed field names
   - New required fields
   - Removed fields

3. Review and update type conversions in:
   - `src/utils/typeConversions.ts`
   - `src/types/native.ts`

### Phase 4: Verification

```bash
# Full validation
npm run fix
npm run typecheck
npm test
npm run test:integration
```

---

## Success Criteria

- [ ] All dependencies updated to Canton 3.4 compatible versions
- [ ] `npm run typecheck` passes with no errors
- [ ] `npm run lint` passes with no warnings
- [ ] `npm test` (unit tests) pass
- [ ] `npm run test:integration` pass against Canton 3.4 LocalNet
- [ ] No regressions in SDK functionality

---

## Dependencies

- Canton 3.4 LocalNet (cn-quickstart) available for testing
- `@fairmint/open-captable-protocol-daml-js` released with Canton 3.4 support
- `@fairmint/canton-node-sdk` updated for Canton 3.4

---

## Notes

- Pinned dependencies: Always use exact versions without `^` or `~`
- Run `npm run fix` before committing to ensure code style compliance
- Test against LocalNet before marking complete

---

## Changelog

| Date       | Change                          | PRs |
| ---------- | ------------------------------- | --- |
| 2025-12-31 | Task created for ocp-canton-sdk | â€”   |

---

_Last updated: 2025-12-31_
